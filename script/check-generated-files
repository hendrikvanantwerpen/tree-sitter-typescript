#!/usr/bin/env bash

set -eu

## Update index to make sure the subsequent diff-index command only reports
## a change if the file content actually changed. Not updating the index can
## give incorrect results when this script is run right after a build.

git update-index -q --refresh

if ! git diff-index --quiet --exit-code HEAD -- {tsx,typescript}/src/; then
    cat 1>&2 <<EOF
Generated files in the working tree are inconsistent with HEAD.
Make sure to commit generated files in {tsx,typescript}/src/ when the grammar changes.
EOF
    exit 1
fi

exit 0
